   DECLARE SUB DRAWLEVEL ()
   DECLARE SUB NOENEMY ()
   DECLARE SUB E1 ()
   DECLARE SUB E2 ()
   DECLARE SUB VICTORY ()
   DECLARE SUB PASSWORD ()
   DECLARE SUB BIGWIN ()
   COMMON SHARED B$, A$, LEND(), POWER, LIFE, FLYSTEP, SCENE, ENEMY, X, Y, A, B, EXPOT, ENEMY1(), ENEMY2(), ENEMY(), PLANE(), BOSS, XA, YA
   COMMON SHARED SPRITE30(), SPRITE31(), KEY1()
   RANDOMIZE TIMER
   SCREEN 9, , 1, 0
   COLOR 15, 3
'ARRAYS
   DIM KEY1(1000)
   DIM LEND(800)
   DIM PLANE(250)
   DIM ENEMY1(250)
   DIM ENEMY2(250)
   DIM ENEMY(250)
   DIM SPRITE30(2500)
   DIM SPRITE31(250)
'OPEN FILE
   DEF SEG = VARSEG(KEY1(0))
   BLOAD "KEY1.SPR", VARPTR(KEY1(0))
   DEF SEG = VARSEG(LEND(0))
   BLOAD "LEND.SPR", VARPTR(LEND(0))
   DEF SEG = VARSEG(PLANE(0))
   BLOAD "PLANE.SPR", VARPTR(PLANE(0))
   DEF SEG = VARSEG(ENEMY1(0))
   BLOAD "ENEMY.SPR", VARPTR(ENEMY1(0))
   DEF SEG = VARSEG(ENEMY2(0))
   BLOAD "ENEMY2.SPR", VARPTR(ENEMY2(0))
   DEF SEG = VARSEG(SPRITE30(0))
   BLOAD "SPRITE30.SPR", VARPTR(SPRITE30(0))
   DEF SEG = VARSEG(SPRITE31(0))
   BLOAD "SPRITE31.SPR", VARPTR(SPRITE31(0))
'VARIABLES
   POWER = 0
   FLYSTEP = 2.5 / 5.0
   LIFE = 5
   SCENE = 1
   EK = 0
   BOSS = 3
   YA = 130
   Y = 150
   RY = 420
BEGIN:
   RY = 420
   ATTACK = 0
   ROCK = 0
   K = 0
   XA = 400
   DRAWLEVEL
START:
   IF BOSS = 0 THEN SCREEN , 0, 1: PUT (XA, YA), SPRITE30: BIGWIN: RUN "AF!.BAS"
   GOSUB DOBOSS
   PUT (X, Y), PLANE, XOR
   PUT (XA, YA), SPRITE30
   IF ATTACK = 1 THEN PUT (RY, YA.B + 5), SPRITE31: PUT (RY, YA.B + 95), SPRITE31
   IF ENEMY = 1 THEN PUT (A, B), ENEMY, XOR
   PCOPY 1, 0
   IF ATTACK = 1 THEN PUT (RY, YA.B + 5), SPRITE31: PUT (RY, YA.B + 95), SPRITE31
   PUT (XA, YA), SPRITE30
   PUT (X, Y), PLANE, XOR
   IF ENEMY = 1 THEN PUT (A, B), ENEMY, XOR
'IFS
   IF X > 573 THEN SCENE = SCENE + 1: CLS : ENEMY = 1: BOSS = BOSS - 1: ROCK = 0: ATTACK = 0: RY = 420: GOTO BEGIN
   IF Y < 30 THEN GOTO EXPLODE
   IF Y > 310 THEN GOTO EXPLODE
   IF ENEMY = 0 THEN GOTO MISS
   IF B < 30 THEN GOTO ENX
   IF B > 310 THEN GOTO ENX
   IF A < 20 THEN ENEMY = 0
MISS:
   IF YA < 30 THEN YA = YA + 20
   IF YA > 230 THEN YA = YA - 20
   GOSUB CHECKWALLS
'IFS
   IF ENEMY = 1 THEN GOSUB ENEMYMOVE
   LET A$ = INKEY$
   IF A$ = CHR$(27) THEN CHAIN "GAMEOVER.BAS"
   IF A$ = CHR$(0) + "H" THEN GOSUB MOVEUP
   IF A$ = CHR$(0) + "P" THEN GOSUB MOVEDN
   IF A$ = CHR$(0) + "M" THEN GOSUB MOVEFASTER
   IF A$ = CHR$(0) + "K" THEN GOSUB MOVESLOWER
   IF A$ <> "" THEN B$ = B$ + A$: PASSWORD
   X = X + FLYSTEP
   GOTO START
   END
MOVEUP:
   FOR MAKEIT = 1 TO 3
   Y = Y - 3
   X = X + FLYSTEP
   GOSUB DOBOSS
   IF ENEMY = 1 THEN B = B + K
   PUT (X, Y), PLANE, XOR
   PUT (XA, YA), SPRITE30
   IF ATTACK = 1 THEN PUT (RY, YA.B + 5), SPRITE31: PUT (RY, YA.B + 95), SPRITE31
   IF ENEMY = 1 THEN PUT (A, B), ENEMY, XOR
   PCOPY 1, 0
   PUT (XA, YA), SPRITE30
   PUT (X, Y), PLANE, XOR
   IF ATTACK = 1 THEN PUT (RY, YA.B + 5), SPRITE31: PUT (RY, YA.B + 95), SPRITE31
   IF ENEMY = 1 THEN PUT (A, B), ENEMY, XOR
   NEXT
   RETURN
   END
MOVEDN:
   FOR MAKEIT = 1 TO 3
   Y = Y + 3
   X = X + FLYSTEP
   GOSUB DOBOSS
   IF ENEMY = 1 THEN B = B + K
   PUT (XA, YA), SPRITE30
   PUT (X, Y), PLANE, XOR
   IF ATTACK = 1 THEN PUT (RY, YA.B + 5), SPRITE31: PUT (RY, YA.B + 95), SPRITE31
   IF ENEMY = 1 THEN PUT (A, B), ENEMY, XOR
   PCOPY 1, 0
   PUT (X, Y), PLANE, XOR
   PUT (XA, YA), SPRITE30
   IF ATTACK = 1 THEN PUT (RY, YA.B + 5), SPRITE31: PUT (RY, YA.B + 95), SPRITE31
   IF ENEMY = 1 THEN PUT (A, B), ENEMY, XOR
   NEXT
   RETURN
   END
MOVEFASTER:
   IF FLYSTEP <> 2.5 / 5.0 THEN RETURN
   FOR MAKEIT = 1 TO 3
   X = X + FLYSTEP + 3
   GOSUB DOBOSS
   IF ENEMY = 1 THEN B = B + K
   PUT (X, Y), PLANE, XOR
   PUT (XA, YA), SPRITE30
   IF ATTACK = 1 THEN PUT (RY, YA.B + 5), SPRITE31: PUT (RY, YA.B + 95), SPRITE31
   IF ENEMY = 1 THEN PUT (A, B), ENEMY, XOR
   PCOPY 1, 0
   PUT (X, Y), PLANE, XOR
   PUT (XA, YA), SPRITE30
   IF ATTACK = 1 THEN PUT (RY, YA.B + 5), SPRITE31: PUT (RY, YA.B + 95), SPRITE31
   IF ENEMY = 1 THEN PUT (A, B), ENEMY, XOR
   NEXT
   RETURN
   END
MOVESLOWER:
   IF FLYSTEP <> 2.5 / 5.0 THEN RETURN
   FOR MAKEIT = 1 TO 3
   X = X + FLYSTEP - 1.2
   GOSUB DOBOSS
   IF ENEMY = 1 THEN B = B + K
   PUT (X, Y), PLANE, XOR
   PUT (XA, YA), SPRITE30
   IF ATTACK = 1 THEN PUT (RY, YA.B + 5), SPRITE31: PUT (RY, YA.B + 95), SPRITE31
   IF ENEMY = 1 THEN PUT (A, B), ENEMY, XOR
   PCOPY 1, 0
   PUT (X, Y), PLANE, XOR
   PUT (XA, YA), SPRITE30
   IF ATTACK = 1 THEN PUT (RY, YA.B + 5), SPRITE31: PUT (RY, YA.B + 95), SPRITE31
   IF ENEMY = 1 THEN PUT (A, B), ENEMY, XOR
   NEXT
   RETURN
   END
CHECKWALLS:
   IF POWER = 1 THEN RETURN
   SCREEN , , 0, 0
   IF POINT(X, Y + 17) <> 0 THEN GOTO EXPLODE
   IF POINT(X + 18, Y) <> 0 THEN GOTO EXPLODE
   IF POINT(X + 18, Y + 34) <> 0 THEN GOTO EXPLODE
   IF POINT(X + 45, Y + 17) <> 0 THEN GOTO EXPLODE
   SCREEN , , 1, 0
   RETURN
   END
EXPLODE:
   SCREEN , , 0, 0
   FOR DI = 1 TO 20 STEP .1
   CIRCLE (X, Y + 10), DI, 4
   CIRCLE (X + 1, Y + 10), DI, 4
   CIRCLE (X + 20, Y + 20), DI, 4
   CIRCLE (X + 1 + 20, Y + 20), DI, 4
   CIRCLE (X + 20, Y), DI, 4
   CIRCLE (X + 1 + 20, Y), DI, 4
   NEXT
   FOR DI = 1 TO 20 STEP .1
   CIRCLE (X, Y + 10), DI, 0
   CIRCLE (X + 1, Y + 10), DI, 0
   CIRCLE (X + 20, Y + 20), DI, 0
   CIRCLE (X + 1 + 20, Y + 20), DI, 0
   CIRCLE (X + 20, Y), DI, 0
   CIRCLE (X + 1 + 20, Y), DI, 0
   NEXT
   LIFE = LIFE - 1
   IF LIFE < 1 THEN CHAIN "GAMEOVER.BAS"
   SCREEN , , 1, 0
   CLS
   ENEMY = 1
   BOSS = 3
   ROCK = 0
   RY = 420
   ATTACK = 0
   Y = 150
   YA = 130
   GOTO BEGIN
   END
ENX:
   SCREEN , , 0, 0
   FOR DI = 1 TO 20 STEP .1
   CIRCLE (A, B + 10), DI, 4
   CIRCLE (A + 1, B + 10), DI, 4
   CIRCLE (A + 20, B + 20), DI, 4
   CIRCLE (A + 1 + 20, B + 20), DI, 4
   CIRCLE (A + 20, B), DI, 4
   CIRCLE (A + 1 + 20, B), DI, 4
   NEXT
   FOR DI = 1 TO 20 STEP .1
   CIRCLE (A, B + 10), DI, 0
   CIRCLE (A + 1, B + 10), DI, 0
   CIRCLE (A + 20, B + 20), DI, 0
   CIRCLE (A + 1 + 20, B + 20), DI, 0
   CIRCLE (A + 20, B), DI, 0
   CIRCLE (A + 1 + 20, B), DI, 0
   NEXT
   SCREEN , , 1, 0
   ENEMY = 0
   GOTO START
   END
ENEMYMOVE:
   K = 0
   FOR UA = A - 50 TO A
   IF POINT(UA, B) <> 0 THEN GOTO DOIT
   IF POINT(UA, B + 34) <> 0 THEN GOTO DOIT
   NEXT
CN:
   A = A - FLYSTEP
   B = B + K
   RETURN
   END
DOIT:
   FOR BO = 31 TO 348
   IF POINT(A - 50, BO) <> 0 AND BO > B THEN K = -6: GOTO CN
   IF POINT(A - 50, BO) <> 0 AND BO < B THEN K = 6: GOTO CN
   IF POINT(A - 50, BO) <> 0 AND BO = B THEN K = 0: GOTO CN
   NEXT
   GOTO CN
   END
DOBOSS:
   MOVE% = INT(RND * 7)
   IF MOVE% = 1 THEN GOSUB SEARCH
   IF MOVE% = 4 AND ROCK = 0 AND ((Y - (YA + 30) < 50 AND Y > (YA + 30)) OR ((YA + 30) - Y < 50 AND (YA + 30) > Y) OR (Y = (YA + 30))) THEN ROCK = 1: ATTACK = 1: YA.B = YA - 10
   IF ATTACK = 1 THEN GOSUB LAUNCH
   RETURN
   END
SEARCH:
   IF YA + 30 > Y THEN YA = YA - 5 / 4.0
   IF YA + 30 < Y THEN YA = YA + 5 / 4.0
   RETURN
   END
LAUNCH:
   IF RY < 15 THEN ATTACK = 0: ROCK = 0: RY = 420: YA.B = YA - 10
   RY = RY - 6
   RETURN
   END

SUB BIGWIN
  FOR AB = 1 TO 55
  FOR PAUSE = 1 TO 5000
  NEXT
  FOR CB = 0 TO 255
  OUT &H3C7, CB: RB = INP(&H3C9): GB = INP(&H3C9): BB = INP(&H3C9)
  IF RB > 0 THEN RB = RB - 1
  IF GB > 0 THEN GB = GB - 1
  IF BB > 0 THEN BB = BB - 1
  OUT &H3C8, CB: OUT &H3C9, RB: OUT &H3C9, GB: OUT &H3C9, BB
  NEXT CB
  NEXT AB
  CLS
  SCREEN 1
  SCREEN 9
  COLOR 15, 8
  PALETTE 10, 42
  PALETTE 2, 51
  PALETTE 6, 2
  LINE (0, 0)-(639, 349), 0, BF
  LINE (0, 0)-(639, 349), 15, B
  PUT (10, 10), KEY1, PSET
  LINE (9, 9)-(83, 103), 2, B
  PAINT (11, 11), 7, 2
  LINE (9, 9)-(83, 103), 15, B
  PUT (240, 10), LEND, XOR
  LOCATE 4, 12
  COLOR 14
  PRINT "You've just completed the first episode!"
  LOCATE 5, 12
  PRINT "Was it hard enough to do it ? I think no."
  LOCATE 6, 12
  PRINT "You are awaited by tons more extra hard levels."
  LOCATE 7, 12
  PRINT "Proceed and complete the whole game."
  COLOR 4
  LOCATE 9, 2
  PRINT "On the picture on the top of the screen there is a stone ü1 that you've found."
  LOCATE 10, 2
  PRINT "It is very powerful, but it only can be activated by other stones."
  LOCATE 11, 2
  PRINT "They are in other worlds and they are guarded by other bosses."
  LOCATE 12, 2
  PRINT "Get the totality of all stones and you'll have the pass into the " + CHR$(34) + "DARK ZONE" + CHR$(34)
  LOCATE 13, 2
  PRINT "Good luck! (You're gonna need it)"
  LOCATE 15, 2
  COLOR 11
  PRINT "PRESS ESCAPE TO CONTINUE"
  DO
  LOOP UNTIL INKEY$ = CHR$(27)
  RUN "AF!.BAS"
END SUB

SUB DRAWLEVEL
   LINE (0, 0)-(639, 30), 15, B
   LINE (5, 13)-(80, 28), 15, B
   LINE (550, 12)-(632, 28), 15, B
   PAINT (1, 1), 8, 15
   LINE (247, 13)-(392, 28), 15, B
   LOCATE 2, 2
   COLOR 14
   PRINT "LIVES:"; LIFE
   LOCATE 2, 70
   COLOR 14
   PRINT "BOSS:"; BOSS
   COLOR 15
   LOCATE 2, 32
   PRINT "     THE BOSS     "
SELECT CASE SCENE
CASE ELSE
   X = 0
   NOENEMY
   END SELECT
END SUB

SUB E1
  ENEMY = 1
  FOR DOENEMY = 0 TO 250
  ENEMY(DOENEMY) = ENEMY1(DOENEMY)
  NEXT
END SUB

SUB E2
  ENEMY = 1
  FOR DOENEMY = 0 TO 250
  ENEMY(DOENEMY) = ENEMY2(DOENEMY)
  NEXT
END SUB

SUB NOENEMY
  ENEMY = 0
END SUB

SUB PASSWORD
  IF LIFE = 9 THEN GOTO MISSIT
  IF INSTR(UCASE$(B$), "LIFE") <> 0 THEN LIFE = LIFE + 1: LOCATE 2, 2: COLOR 14: PRINT "LIVES:"; LIFE: B$ = ""
MISSIT:
  IF FLYSTEP > 6 THEN GOTO MISSOT
  IF INSTR(UCASE$(B$), "FAST") <> 0 THEN FLYSTEP = FLYSTEP + .5 / 5.0: B$ = ""
MISSOT:
  IF FLYSTEP = 1 THEN GOTO MISSTH
  IF INSTR(UCASE$(B$), "SLOW") <> 0 THEN FLYSTEP = FLYSTEP - .5 / 5.0: B$ = ""
MISSTH:
  IF INSTR(UCASE$(B$), "NEXT") <> 0 THEN SCENE = SCENE + 1: CLS :  B$ = "": DRAWLEVEL
  IF INSTR(UCASE$(B$), "-PAL") <> 0 THEN GOSUB GAMMA: B$ = ""
  IF INSTR(UCASE$(B$), "FULL") <> 0 THEN LIFE = 9: LOCATE 2, 2: COLOR 14: PRINT "LIVES:"; LIFE: B$ = ""
  IF INSTR(UCASE$(B$), "NULL") <> 0 THEN CLS : B$ = ""
  IF INSTR(UCASE$(B$), "E1") <> 0 THEN A = 585: B = 150: E1: B$ = ""
  IF INSTR(UCASE$(B$), "E2") <> 0 THEN A = 585: B = 150: E2: B$ = ""
  IF INSTR(UCASE$(B$), "GHOST") <> 0 THEN POWER = 1: B$ = ""
  IF INSTR(UCASE$(B$), "ALIVE") <> 0 THEN POWER = 0: B$ = ""
  IF INSTR(UCASE$(B$), "MAD") <> 0 THEN POWER = 1: FLYSTEP = 5.5 / 5.0: B$ = ""
  IF INSTR(UCASE$(B$), "CALM") <> 0 THEN POWER = 0: FLYSTEP = 2.5 / 5.0: B$ = ""
  IF INSTR(UCASE$(B$), "MSG") <> 0 THEN LOCATE 2, 33: COLOR 15: PRINT "YOU'LL NEVER WIN": B$ = ""
  IF INSTR(UCASE$(B$), "WIN") <> 0 THEN VICTORY: B$ = ""
  GOTO ENDIT
GAMMA:
  FOR AB = 1 TO 10
  FOR CB = 0 TO 255
  OUT &H3C7, CB: RB = INP(&H3C9): GB = INP(&H3C9): BB = INP(&H3C9)
  IF RB > 0 THEN RB = RB - 1
  IF GB > 0 THEN GB = GB - 1
  IF BB > 0 THEN BB = BB - 1
  OUT &H3C8, CB: OUT &H3C9, RB: OUT &H3C9, GB: OUT &H3C9, BB
  NEXT CB
  NEXT AB
  RETURN
ENDIT:
END SUB

SUB VICTORY
  SCREEN , , 0, 0
  PUT (220, 170), LEND, PSET
  FOR CYCLE = 1 TO FLYSTEP * 150000
  NEXT
  END
END SUB

